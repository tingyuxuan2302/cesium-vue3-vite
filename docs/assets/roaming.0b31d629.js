import{_ as f}from"./OperateBox.66cb383c.js";import{o as g,c as v,w as h,d,e as u}from"./index.bc967ea1.js";import{E as C}from"./el-button.3d1567a4.js";import{g as w}from"./api.0d3194e0.js";import"./request.00b81209.js";class y{constructor(t,e){this.viewer=t,this.pause=!0,e=e||{},this.Lines=[],this.entity=void 0,this.start=void 0,this.stop=void 0,this.time=e.time?e.time:360,this.multiplier=e.multiplier?e.multiplier:1,this.isPattern=!0,this.data={},this.ifClockLoop=!1}_ComputeRoamingLineProperty(t,e){let a=new Cesium.SampledPositionProperty,i=t.length,r=e,s=Cesium.JulianDate.now();this.start=s;let n=Cesium.JulianDate.addSeconds(s,e,new Cesium.JulianDate);this.stop=n,this.viewer.clock.startTime=s.clone(),this.viewer.clock.stopTime=n.clone(),this.viewer.clock.currentTime=s.clone(),this.ifClockLoop?this.viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP:(this.viewer.clock.clockRange=Cesium.ClockRange.CLAMPED,this.viewer.clock.clockStep=Cesium.ClockStep.SYSTEM_CLOCK),this.viewer.clock.shouldAnimate=!0,this.viewer.clock.multiplier=this.multiplier;for(let o=0;o<i;o++){var e=Cesium.JulianDate.addSeconds(s,o*r/i,new Cesium.JulianDate);o==i-1&&(e=n);let l=t[o];this.ifTileset&&(l=this.viewer.scene.clampToHeight(l)),a.addSample(e,l)}return a}cameraRoaming(t){this.Lines=t;var e=this._ComputeRoamingLineProperty(this.Lines,this.time);this._InitRoaming(e,this.start,this.stop)}_InitRoaming(t,e,a){this.entity=this.viewer.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:e,stop:a})]),position:t,orientation:new Cesium.VelocityOrientationProperty(t)}),this.entity.position.setInterpolationOptions({interpolationDegree:100,interpolationAlgorithm:Cesium.HermitePolynomialApproximation}),this.viewer.trackedEntity=this.entity;var i=this.viewer.camera,r=this,s=function(){if(r.entity){var n=r.entity.position.getValue(r.viewer.clock.currentTime);n&&i.lookAt(n,{heading:Cesium.Math.toRadians(117.7),pitch:Cesium.Math.toRadians(0),range:100}),r.viewer.clock.shouldAnimate&&n&&r._realTimeData(n)}else r.viewer.scene.preUpdate.removeEventListener(s)};r.viewer.scene.preUpdate.addEventListener(s)}modelRoaming(t){this.modelData={},this.Lines=t.Lines;var e={minimumPixelSize:64},a={show:!1},i={show:!1,material:Cesium.Color.RED},r={show:!1,topRadius:0,bottomRadius:100,material:Cesium.Color.RED.withAlpha(.3),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND},s={show:!1};this.ifAffixedTo=t.ifAffixedTo?t.ifAffixedTo:!1,this.ifClockLoop=t.ifClockLoop?t.ifClockLoop:!1,this.interpolation=t.interpolation?t.interpolation:!1,this.showLabel=t.showLabel?t.showLabel:!1,this.ifTileset=t.ifTileset?t.ifTileset:!1,this.modelData.model=Object.assign(e,t.model),this.modelData.path=Object.assign(a,t.path),this.modelData.label=Object.assign(s,t.label),this.modelData.polyline=Object.assign(i,t.polyline),this.modelData.cylinder=Object.assign(r,t.cylinder),this.modelData.polyline.positions=new Cesium.CallbackProperty(function(){},!1),this.modelData.cylinder.length=new Cesium.CallbackProperty(function(){},!1);var n=this._ComputeRoamingLineProperty(this.Lines,this.time);this._modelInitRoaming(n,this.start,this.stop,t.model,t.path)}_modelInitRoaming(t,e,a){var i=this;this.entity=this.viewer.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:e,stop:a})]),position:t,orientation:new Cesium.VelocityOrientationProperty(t),model:this.modelData.model,label:this.modelData.label,path:this.modelData.path}),!i.ifAffixedTo&&i.interpolation&&this.entity.position.setInterpolationOptions({interpolationDegree:5,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation}),i.polyline=i.viewer.entities.add({polyline:i.modelData.polyline}),i.cylinder=i.viewer.entities.add({position:t,orientation:new Cesium.VelocityOrientationProperty(t),cylinder:this.modelData.cylinder});var r=[],s=function(){if(i.entity){if(i.viewer.clock.shouldAnimate){var n=i.entity.position.getValue(i.viewer.clock.currentTime);if(i.modelData.polyline.show&&(r.push(n),i.modelData.polyline.positions._callback=function(){return r}),i.ifAffixedTo){var o=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(n);let m=i.viewer.terrainProvider.availability?i.viewer.terrainProvider:Cesium.createWorldTerrain();Cesium.sampleTerrainMostDetailed(m,[Cesium.Cartographic.fromDegrees(o.longitude/Math.PI*180,o.latitude/Math.PI*180)]).then(function(l){i.entity.position.addSample(i.viewer.clock.currentTime,Cesium.Cartesian3.fromRadians(l[0].longitude,l[0].latitude,l[0].height))})}i.ifTileset&&i.entity.position.addSample(i.viewer.clock.currentTime,i.viewer.scene.clampToHeight(n,[i.entity])),i.modelData.cylinder.show&&(i.modelData.cylinder.length._callback=function(){return i.viewer.scene.globe.ellipsoid.cartesianToCartographic(n).height}),n&&i._realTimeData(n)}}else i.viewer.scene.preUpdate.removeEventListener(s)};i.viewer.scene.preUpdate.addEventListener(s),i.changingView(2)}PauseOrContinue(t){this.viewer.clock.shouldAnimate=t}ChangeRoamingSpeed(t){this.viewer.clock.multiplier=t}EndRoaming(){this.entity!==void 0&&(this.viewer.entities.remove(this.entity),this.viewer.entities.remove(this.polyline),this.viewer.entities.remove(this.cylinder),this.entity=void 0,this.polyline=void 0,this.cylinder=void 0,this.PauseOrContinue(!1))}getData(t){var e=this;Object.defineProperty(this.data,"shouldAnimate",{set:function(a){return t(e.data)}})}changingView(t,a){var a=a||{};this.viewer.trackedEntity=void 0,t==1?this.viewer.trackedEntity=this.entity:t==2?this.viewer.zoomTo(this.viewer.entities,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90))):t==3?this.viewer.zoomTo(this.viewer.entities,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(-90),Cesium.Math.toRadians(-15),8e3)):t==4&&this.viewer.zoomTo(this.viewer.entities,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(a.heading?a.heading:0),Cesium.Math.toRadians(a.pitch?a.pitch:0),a.range?a.range:0))}_realTimeData(t){var e=this;e.data.shouldAnimate=e.viewer.clock.shouldAnimate,e.data.totalLength=e._disTance(e.Lines),e.data.totalTime=e._formateSeconds(e.time);var a=Cesium.JulianDate.secondsDifference(e.viewer.clock.currentTime,e.viewer.clock.startTime);e.data.delTime=e._formateSeconds(a),e.data.roamingLength=(e.data.totalLength/e.time*a).toFixed(3);var i=e.viewer.scene.globe.ellipsoid.cartesianToCartographic(t);e.data.longitude=(i.longitude/Math.PI*180).toFixed(6),e.data.latitude=(i.latitude/Math.PI*180).toFixed(6);let r=e.viewer.terrainProvider.availability?e.viewer.terrainProvider:Cesium.createWorldTerrain();Cesium.sampleTerrainMostDetailed(r,[Cesium.Cartographic.fromDegrees(i.longitude/Math.PI*180,i.latitude/Math.PI*180)]).then(function(s){e.data.roamingElevation=(s[0].height+i.height).toFixed(2),e.data.terrainHeight=s[0].height.toFixed(2),e.data.liftoffHeight=(e.data.roamingElevation-e.data.terrainHeight).toFixed(2)}),e.data.progress=(e.data.roamingLength/e.data.totalLength*100).toFixed(0)+"%"}_disTance(t){for(var e=0,a=0;a<t.length-1;a++){var i=Cesium.Cartographic.fromCartesian(t[a]),r=Cesium.Cartographic.fromCartesian(t[a+1]),s=new Cesium.EllipsoidGeodesic;s.setEndPoints(i,r);var n=s.surfaceDistance;n=Math.sqrt(Math.pow(n,2)+Math.pow(r.height-i.height,2)),e=e+n}return e.toFixed(3)}_formateSeconds(t){let e=parseInt(t),a=0,i=0,r="";return e>=60&&(a=parseInt(e/60),e=parseInt(e%60),a>=60&&(i=parseInt(a/60),a=parseInt(a%60))),i=i.toString()==0?"":i.toString()+"\u5C0F\u65F6",a=a.toString()==0?"":a.toString()+"\u5206\u949F",e=e.toString()==0?"":e.toString()+"\u79D2",r=`${i+a+e}`,r==""?"0\u79D2":r}}const P={__name:"roaming",setup(p){const{__viewer:t}=window;var e=new y(t,{time:30});const a=()=>{w("/cesium-vue3-vite/json/roaming.json").then(({res:n})=>{i(n)})};function i(n){let o=n.features[0].geometry.coordinates,m=[];o.forEach(l=>{m.push(Cesium.Cartesian3.fromDegrees(l[0],l[1],1e3))}),e.modelRoaming({model:{uri:"/cesium-vue3-vite/models/Cesium_Air.glb",scale:30,silhouetteSize:5,silhouetteColor:Cesium.Color.fromCssColorString("#001aff")},Lines:m,path:{show:!0},polyline:{show:!0,material:Cesium.Color.RED}})}const r=n=>{e.PauseOrContinue(n)},s=()=>{e.EndRoaming()};return(n,o)=>{const m=C,l=f;return g(),v(l,null,{default:h(()=>[d(m,{type:"primary",onClick:a},{default:h(()=>o[3]||(o[3]=[u("\u5F00\u59CB\u8FD0\u52A8")])),_:1}),d(m,{type:"primary",onClick:o[0]||(o[0]=c=>r(!1))},{default:h(()=>o[4]||(o[4]=[u("\u6682\u505C")])),_:1}),d(m,{type:"primary",onClick:o[1]||(o[1]=c=>r(!0))},{default:h(()=>o[5]||(o[5]=[u("\u7EE7\u7EED")])),_:1}),d(m,{type:"primary",onClick:o[2]||(o[2]=c=>s())},{default:h(()=>o[6]||(o[6]=[u("\u53D6\u6D88")])),_:1})]),_:1})}}};export{P as default};
