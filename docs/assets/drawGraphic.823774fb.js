class r{constructor(e){this.viewer=e,this._drawHandler=null,this._dataSource=null,this._tempPositions=[],this._mousePos=null,this._drawType=null}activate(e,i){this.clearAll(),this._drawType=e,this._dataSource=new Cesium.CustomDataSource("_dataSource"),this.viewer.dataSources.add(this._dataSource),this._registerEvents(i)}_registerEvents(e){switch(this._drawHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.viewer.scene.globe.depthTestAgainstTerrain=!0,this._drawType){case"Point":{this._leftClickEventForPoint();break}case"Polyline":{this._leftClickEventForPolyline(),this._mouseMoveEventForPolyline(),this._rightClickEventForPolyline(),this._doubleClickEventForPolyline();break}case"Polygon":{this._leftClickEventForPolygon(),this._mouseMoveEventForPolygon(),this._rightClickEventForPolygon(e),this._doubleClickEventForPolygon(e);break}}}_leftClickEventForPoint(){this._drawHandler.setInputAction(e=>{let i=this.viewer.scene.pickPosition(e.position);if(!i)return;let t=Cesium.Cartographic.fromCartesian(i),o=[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height+50];this._addPoint(o)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}_leftClickEventForPolyline(){this._drawHandler.setInputAction(e=>{let i=this.viewer.scene.pickPosition(e.position);!i||(this._tempPositions.push(i),this._addPolyline())},Cesium.ScreenSpaceEventType.LEFT_CLICK)}_mouseMoveEventForPolyline(){this._drawHandler.setInputAction(e=>{let i=this.viewer.scene.pickPosition(e.endPosition);!i||(this._mousePos=i)},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}_rightClickEventForPolyline(){this._drawHandler.setInputAction(e=>{!this.viewer.scene.pickPosition(e.position)||(this._removeAllEvent(),this._dataSource.entities.removeAll(),this._dataSource.entities.add({polyline:{positions:this._tempPositions,clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}}))},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}_doubleClickEventForPolyline(){this._drawHandler.setInputAction(e=>{!this.viewer.scene.pickPosition(e.position)||(this._removeAllEvent(),this._dataSource.entities.removeAll(),this._dataSource.entities.add({polyline:{positions:this._tempPositions,clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}}))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}_leftClickEventForPolygon(){this._drawHandler.setInputAction(e=>{let i=this.viewer.scene.pickPosition(e.position);!i||(this._tempPositions.push(i),this._addPolygon())},Cesium.ScreenSpaceEventType.LEFT_CLICK)}_mouseMoveEventForPolygon(){this._drawHandler.setInputAction(e=>{let i=this.viewer.scene.pickPosition(e.endPosition);!i||(this._mousePos=i)},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}_rightClickEventForPolygon(e){this._drawHandler.setInputAction(i=>{if(!this.viewer.scene.pickPosition(i.position))return;this._tempPositions.push(this._tempPositions[0]),this._removeAllEvent(),this._dataSource.entities.removeAll();const o=this._dataSource.entities.add({polyline:{positions:this._tempPositions,clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})},polygon:{hierarchy:this._tempPositions,extrudedHeightReference:Cesium.HeightReference.CLAMP_TO_GROUND,material:Cesium.Color.RED.withAlpha(.4),clampToGround:!0}});e&&typeof e=="function"&&e(o)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}_doubleClickEventForPolygon(e){this._drawHandler.setInputAction(i=>{if(!this.viewer.scene.pickPosition(i.position))return;this._tempPositions.push(this._tempPositions[0]),this._removeAllEvent(),this._dataSource.entities.removeAll();const o=this._dataSource.entities.add({polyline:{positions:this._tempPositions,clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})},polygon:{hierarchy:this._tempPositions,extrudedHeightReference:Cesium.HeightReference.CLAMP_TO_GROUND,material:Cesium.Color.RED.withAlpha(.4),clampToGround:!0}});e&&typeof e=="function"&&e(o)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}_removeAllEvent(){this._drawHandler&&(this._drawHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._drawHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._drawHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._drawHandler.destroy(),this._drawHandler=null)}_resetParams(){this._dataSource!=null&&(this._dataSource.entities.removeAll(),this.viewer.dataSources.remove(this._dataSource)),this._dataSource=null,this._tempPositions=[],this._mousePos=null,this._drawType=null}clearAll(){this._removeAllEvent(),this._resetParams()}_addPoint(e){this._dataSource.entities.add({position:Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),point:{color:Cesium.Color.RED,pixelSize:10,outlineColor:Cesium.Color.YELLOW,outlineWidth:2}})}_addPolyline(){this._dataSource.entities.add({polyline:{positions:new Cesium.CallbackProperty(()=>{let e=Array.from(this._tempPositions);return this._mousePos&&e.push(this._mousePos),e},!1),clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}})}_addPolygon(){this._tempPositions.length==1?this._dataSource.entities.add({polyline:{positions:new Cesium.CallbackProperty(()=>{let e=Array.from(this._tempPositions);return this._mousePos&&e.push(this._mousePos),e},!1),clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}}):(this._dataSource.entities.removeAll(),this._dataSource.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty(()=>{let e=Array.from(this._tempPositions);return this._mousePos&&e.push(this._mousePos),new Cesium.PolygonHierarchy(e)},!1),extrudedHeightReference:Cesium.HeightReference.CLAMP_TO_GROUND,material:Cesium.Color.RED.withAlpha(.4),clampToGround:!0},polyline:{positions:new Cesium.CallbackProperty(()=>{let e=Array.from(this._tempPositions);return this._mousePos&&(e.push(this._mousePos),e.push(e[0])),e},!1),clampToGround:!0,width:3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}}))}}export{r as D};
