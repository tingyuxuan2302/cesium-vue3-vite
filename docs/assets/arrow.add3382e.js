import{_ as W}from"./OperateBox.66cb383c.js";import{u as B,D as N,a as V,o as j,c as z,w as E,d as S,e as k}from"./index.bc967ea1.js";import{E as x}from"./el-button.3d1567a4.js";var o={version:"1.0.0"};o.PlotUtils={},o.PlotUtils.distance=function(i,r){return Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))},o.PlotUtils.wholeDistance=function(i){for(var r=0,e=0;e<i.length-1;e++)r+=o.PlotUtils.distance(i[e],i[e+1]);return r},o.PlotUtils.getBaseLength=function(i){return Math.pow(o.PlotUtils.wholeDistance(i),.99)},o.PlotUtils.mid=function(i,r){return[(i[0]+r[0])/2,(i[1]+r[1])/2]},o.PlotUtils.getCircleCenterOfThreePoints=function(i,r,e){var n=[(i[0]+r[0])/2,(i[1]+r[1])/2],s=[n[0]-i[1]+r[1],n[1]+i[0]-r[0]],a=[(i[0]+e[0])/2,(i[1]+e[1])/2],l=[a[0]-i[1]+e[1],a[1]+i[0]-e[0]];return o.PlotUtils.getIntersectPoint(n,s,a,l)},o.PlotUtils.getIntersectPoint=function(i,r,e,n){if(i[1]==r[1]){var s=(n[0]-e[0])/(n[1]-e[1]),a=s*(i[1]-e[1])+e[0],l=i[1];return[a,l]}if(e[1]==n[1]){var h=(r[0]-i[0])/(r[1]-i[1]);return a=h*(e[1]-i[1])+i[0],l=e[1],[a,l]}return h=(r[0]-i[0])/(r[1]-i[1]),s=(n[0]-e[0])/(n[1]-e[1]),l=(h*i[1]-i[0]-s*e[1]+e[0])/(h-s),a=h*l-h*i[1]+i[0],[a,l]},o.PlotUtils.getAzimuth=function(i,r){var e,n=Math.asin(Math.abs(r[1]-i[1])/o.PlotUtils.distance(i,r));return r[1]>=i[1]&&r[0]>=i[0]?e=n+Math.PI:r[1]>=i[1]&&r[0]<i[0]?e=o.Constants.TWO_PI-n:r[1]<i[1]&&r[0]<i[0]?e=n:r[1]<i[1]&&r[0]>=i[0]&&(e=Math.PI-n),e},o.PlotUtils.getAngleOfThreePoints=function(i,r,e){var n=o.PlotUtils.getAzimuth(r,i)-o.PlotUtils.getAzimuth(r,e);return 0>n?n+o.Constants.TWO_PI:n},o.PlotUtils.isClockWise=function(i,r,e){return(e[1]-i[1])*(r[0]-i[0])>(r[1]-i[1])*(e[0]-i[0])},o.PlotUtils.getPointOnLine=function(i,r,e){var n=r[0]+i*(e[0]-r[0]),s=r[1]+i*(e[1]-r[1]);return[n,s]},o.PlotUtils.getCubicValue=function(i,r,e,n,s){i=Math.max(Math.min(i,1),0);var a=1-i,l=i*i,h=l*i,c=a*a,d=c*a,f=d*r[0]+3*c*i*e[0]+3*a*l*n[0]+h*s[0],P=d*r[1]+3*c*i*e[1]+3*a*l*n[1]+h*s[1];return[f,P]},o.PlotUtils.getThirdPoint=function(i,r,e,n,s){var a=o.PlotUtils.getAzimuth(i,r),l=s?a+e:a-e,h=n*Math.cos(l),c=n*Math.sin(l);return[r[0]+h,r[1]+c]},o.PlotUtils.getArcPoints=function(i,r,e,n){var s,a,l=[],h=n-e;h=0>h?h+o.Constants.TWO_PI:h;for(var c=0;c<=o.Constants.FITTING_COUNT;c++){var d=e+h*c/o.Constants.FITTING_COUNT;s=i[0]+r*Math.cos(d),a=i[1]+r*Math.sin(d),l.push([s,a])}return l},o.PlotUtils.getBisectorNormals=function(i,r,e,n){var s=o.PlotUtils.getNormal(r,e,n),a=Math.sqrt(s[0]*s[0]+s[1]*s[1]),l=s[0]/a,h=s[1]/a,c=o.PlotUtils.distance(r,e),d=o.PlotUtils.distance(e,n);if(a>o.Constants.ZERO_TOLERANCE)if(o.PlotUtils.isClockWise(r,e,n)){var f=i*c,P=e[0]-f*h,u=e[1]+f*l,p=[P,u];f=i*d,P=e[0]+f*h,u=e[1]-f*l;var g=[P,u]}else f=i*c,P=e[0]+f*h,u=e[1]-f*l,p=[P,u],f=i*d,P=e[0]-f*h,u=e[1]+f*l,g=[P,u];else P=e[0]+i*(r[0]-e[0]),u=e[1]+i*(r[1]-e[1]),p=[P,u],P=e[0]+i*(n[0]-e[0]),u=e[1]+i*(n[1]-e[1]),g=[P,u];return[p,g]},o.PlotUtils.getNormal=function(i,r,e){var n=i[0]-r[0],s=i[1]-r[1],a=Math.sqrt(n*n+s*s);n/=a,s/=a;var l=e[0]-r[0],h=e[1]-r[1],c=Math.sqrt(l*l+h*h);l/=c,h/=c;var d=n+l,f=s+h;return[d,f]},o.PlotUtils.getCurvePoints=function(i,r){for(var e=o.PlotUtils.getLeftMostControlPoint(r),n=[e],s=0;s<r.length-2;s++){var a=r[s],l=r[s+1],h=r[s+2],c=o.PlotUtils.getBisectorNormals(i,a,l,h);n=n.concat(c)}var d=o.PlotUtils.getRightMostControlPoint(r);n.push(d);var f=[];for(s=0;s<r.length-1;s++){a=r[s],l=r[s+1],f.push(a);for(var i=0;i<o.Constants.FITTING_COUNT;i++){var P=o.PlotUtils.getCubicValue(i/o.Constants.FITTING_COUNT,a,n[2*s],n[2*s+1],l);f.push(P)}f.push(l)}return f},o.PlotUtils.getLeftMostControlPoint=function(i){var r=i[0],e=i[1],n=i[2],s=o.PlotUtils.getBisectorNormals(0,r,e,n),a=s[0],l=o.PlotUtils.getNormal(r,e,n),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]);if(h>o.Constants.ZERO_TOLERANCE)var c=o.PlotUtils.mid(r,e),d=r[0]-c[0],f=r[1]-c[1],P=o.PlotUtils.distance(r,e),u=2/P,p=-u*f,g=u*d,w=p*p-g*g,m=2*p*g,A=g*g-p*p,y=a[0]-c[0],T=a[1]-c[1],F=c[0]+w*y+m*T,I=c[1]+m*y+A*T;else F=r[0]+t*(e[0]-r[0]),I=r[1]+t*(e[1]-r[1]);return[F,I]},o.PlotUtils.getRightMostControlPoint=function(i){var r=i.length,e=i[r-3],n=i[r-2],s=i[r-1],a=o.PlotUtils.getBisectorNormals(0,e,n,s),l=a[1],h=o.PlotUtils.getNormal(e,n,s),c=Math.sqrt(h[0]*h[0]+h[1]*h[1]);if(c>o.Constants.ZERO_TOLERANCE)var d=o.PlotUtils.mid(n,s),f=s[0]-d[0],P=s[1]-d[1],u=o.PlotUtils.distance(n,s),p=2/u,g=-p*P,w=p*f,m=g*g-w*w,A=2*g*w,y=w*w-g*g,T=l[0]-d[0],F=l[1]-d[1],I=d[0]+m*T+A*F,D=d[1]+A*T+y*F;else I=s[0]+t*(n[0]-s[0]),D=s[1]+t*(n[1]-s[1]);return[I,D]},o.PlotUtils.getBezierPoints=function(i){if(i.length<=2)return i;for(var r=[],e=i.length-1,n=0;1>=n;n+=.01){for(var s=0,a=0,l=0;e>=l;l++){var h=o.PlotUtils.getBinomialFactor(e,l),c=Math.pow(n,l),d=Math.pow(1-n,e-l);s+=h*c*d*i[l][0],a+=h*c*d*i[l][1]}r.push([s,a])}return r.push(i[e]),r},o.PlotUtils.getBinomialFactor=function(i,r){return o.PlotUtils.getFactorial(i)/(o.PlotUtils.getFactorial(r)*o.PlotUtils.getFactorial(i-r))},o.PlotUtils.getFactorial=function(i){if(1>=i)return 1;if(i==2)return 2;if(i==3)return 6;if(i==4)return 24;if(i==5)return 120;for(var r=1,e=1;i>=e;e++)r*=e;return r},o.PlotUtils.getQBSplinePoints=function(i){if(i.length<=2)return i;var r=2,e=[],n=i.length-r-1;e.push(i[0]);for(var s=0;n>=s;s++)for(var a=0;1>=a;a+=.05){for(var l=0,h=0,c=0;r>=c;c++){var d=o.PlotUtils.getQuadricBSplineFactor(c,a);l+=d*i[s+c][0],h+=d*i[s+c][1]}e.push([l,h])}return e.push(i[i.length-1]),e},o.PlotUtils.getQuadricBSplineFactor=function(i,r){return i==0?Math.pow(r-1,2)/2:i==1?(-2*Math.pow(r,2)+2*r+1)/2:i==2?Math.pow(r,2)/2:0},o.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4};var v={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},U={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15},b={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1},M={tailWidthFactor:.15,neckWidthFactor:.2,headWidthFactor:.25,headAngle:Math.PI/8.5,neckAngle:Math.PI/13};v.algorithm={},v.algorithm.doubleArrow=function(i){this.connPoint=null,this.tempPoint4=null,this.points=i;var r={controlPoint:null,polygonalPoint:null},e=i.length;if(!(2>e)){if(e==2)return i;var n=this.points[0],s=this.points[1],a=this.points[2],e=i.length;e==3?this.tempPoint4=v.algorithm.getTempPoint4(n,s,a):this.tempPoint4=this.points[3],e==3||e==4?this.connPoint=o.PlotUtils.mid(n,s):this.connPoint=this.points[4];var l,h;o.PlotUtils.isClockWise(n,s,a)?(l=v.algorithm.getArrowPoints(n,this.connPoint,this.tempPoint4,!1),h=v.algorithm.getArrowPoints(this.connPoint,s,a,!0)):(l=v.algorithm.getArrowPoints(s,this.connPoint,a,!1),h=v.algorithm.getArrowPoints(this.connPoint,n,this.tempPoint4,!0));var c=l.length,d=(c-5)/2,f=l.slice(0,d),P=l.slice(d,d+5),u=l.slice(d+5,c),p=h.slice(0,d),g=h.slice(d,d+5),w=h.slice(d+5,c);p=o.PlotUtils.getBezierPoints(p);var m=o.PlotUtils.getBezierPoints(w.concat(f.slice(1)));u=o.PlotUtils.getBezierPoints(u);var A=p.concat(g,m,P,u),y=v.algorithm.array2Dto1D(A);r.controlPoint=[n,s,a,this.tempPoint4,this.connPoint],r.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(y)}return r},v.algorithm.threeArrow=function(i){this.connPoint=null,this.tempPoint4=null,this.tempPoint5=null,this.points=i;var r={controlPoint:null,polygonalPoint:null},e=i.length;if(e>=2){if(e==2)return i;var n=this.points[0],s=this.points[1],a=this.points[2],e=i.length;e==3?(this.tempPoint4=v.algorithm.getTempPoint4(n,s,a),this.tempPoint5=o.PlotUtils.mid(a,this.tempPoint4)):(this.tempPoint4=this.points[3],this.tempPoint5=this.points[4]),e<6?this.connPoint=o.PlotUtils.mid(n,s):this.connPoint=this.points[5];var l,h;o.PlotUtils.isClockWise(n,s,a)?(l=v.algorithm.getArrowPoints(n,this.connPoint,this.tempPoint4,!1),h=v.algorithm.getArrowPoints(this.connPoint,s,a,!0)):(l=v.algorithm.getArrowPoints(s,this.connPoint,a,!1),h=v.algorithm.getArrowPoints(this.connPoint,n,this.tempPoint4,!0));var c=l.length,d=(c-5)/2,f=l.slice(0,d),P=l.slice(d,d+5),u=l.slice(d+5,c),p=h.slice(0,d),g=h.slice(d,d+5),w=h.slice(d+5,c);p=o.PlotUtils.getBezierPoints(p);var m=o.PlotUtils.getBezierPoints(w.concat(f.slice(1)));u=o.PlotUtils.getBezierPoints(u);var A=p.concat(g,m,P,u),y=v.algorithm.array2Dto1D(A);r.controlPoint=[n,s,a,this.tempPoint4,this.tempPoint5,this.connPoint],r.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(y)}return r},v.algorithm.array2Dto1D=function(i){var r=[];return i.forEach(function(e){r.push(e[0]),r.push(e[1])}),r},v.algorithm.getArrowPoints=function(i,r,e,n){this.type=U.type,this.headHeightFactor=U.headHeightFactor,this.headWidthFactor=U.headWidthFactor,this.neckHeightFactor=U.neckHeightFactor,this.neckWidthFactor=U.neckWidthFactor;var s=o.PlotUtils.mid(i,r),a=o.PlotUtils.distance(s,e),l=o.PlotUtils.getThirdPoint(e,s,0,.3*a,!0),h=o.PlotUtils.getThirdPoint(e,s,0,.5*a,!0);l=o.PlotUtils.getThirdPoint(s,l,o.Constants.HALF_PI,a/5,n),h=o.PlotUtils.getThirdPoint(s,h,o.Constants.HALF_PI,a/4,n);var c=[s,l,h,e],d=v.algorithm.getArrowHeadPoints(c,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),f=d[0],P=d[4],u=o.PlotUtils.distance(i,r)/o.PlotUtils.getBaseLength(c)/2,p=v.algorithm.getArrowBodyPoints(c,f,P,u),g=p.length,w=p.slice(0,g/2),m=p.slice(g/2,g);return w.push(f),m.push(P),w=w.reverse(),w.push(r),m=m.reverse(),m.push(i),w.reverse().concat(d,m)},v.algorithm.getArrowHeadPoints=function(i,r,e){this.type=U.type,this.headHeightFactor=U.headHeightFactor,this.headWidthFactor=U.headWidthFactor,this.neckHeightFactor=U.neckHeightFactor,this.neckWidthFactor=U.neckWidthFactor;var n=o.PlotUtils.getBaseLength(i),s=n*this.headHeightFactor,a=i[i.length-1],l=(o.PlotUtils.distance(r,e),s*this.headWidthFactor),h=s*this.neckWidthFactor,c=s*this.neckHeightFactor,d=o.PlotUtils.getThirdPoint(i[i.length-2],a,0,s,!0),f=o.PlotUtils.getThirdPoint(i[i.length-2],a,0,c,!0),P=o.PlotUtils.getThirdPoint(a,d,o.Constants.HALF_PI,l,!1),u=o.PlotUtils.getThirdPoint(a,d,o.Constants.HALF_PI,l,!0),p=o.PlotUtils.getThirdPoint(a,f,o.Constants.HALF_PI,h,!1),g=o.PlotUtils.getThirdPoint(a,f,o.Constants.HALF_PI,h,!0);return[p,P,a,u,g]},v.algorithm.getArrowBodyPoints=function(i,r,e,n){for(var s=o.PlotUtils.wholeDistance(i),a=o.PlotUtils.getBaseLength(i),l=a*n,h=o.PlotUtils.distance(r,e),c=(l-h)/2,d=0,f=[],P=[],u=1;u<i.length-1;u++){var p=o.PlotUtils.getAngleOfThreePoints(i[u-1],i[u],i[u+1])/2;d+=o.PlotUtils.distance(i[u-1],i[u]);var g=(l/2-d/s*c)/Math.sin(p),w=o.PlotUtils.getThirdPoint(i[u-1],i[u],Math.PI-p,g,!0),m=o.PlotUtils.getThirdPoint(i[u-1],i[u],p,g,!1);f.push(w),P.push(m)}return f.concat(P)},v.algorithm.getTempPoint4=function(i,r,e){var n,s,a,l,h=o.PlotUtils.mid(i,r),c=o.PlotUtils.distance(h,e),d=o.PlotUtils.getAngleOfThreePoints(i,h,e);return d<o.Constants.HALF_PI?(s=c*Math.sin(d),a=c*Math.cos(d),l=o.PlotUtils.getThirdPoint(i,h,o.Constants.HALF_PI,s,!1),n=o.PlotUtils.getThirdPoint(h,l,o.Constants.HALF_PI,a,!0)):d>=o.Constants.HALF_PI&&d<Math.PI?(s=c*Math.sin(Math.PI-d),a=c*Math.cos(Math.PI-d),l=o.PlotUtils.getThirdPoint(i,h,o.Constants.HALF_PI,s,!1),n=o.PlotUtils.getThirdPoint(h,l,o.Constants.HALF_PI,a,!1)):d>=Math.PI&&d<1.5*Math.PI?(s=c*Math.sin(d-Math.PI),a=c*Math.cos(d-Math.PI),l=o.PlotUtils.getThirdPoint(i,h,o.Constants.HALF_PI,s,!0),n=o.PlotUtils.getThirdPoint(h,l,o.Constants.HALF_PI,a,!0)):(s=c*Math.sin(2*Math.PI-d),a=c*Math.cos(2*Math.PI-d),l=o.PlotUtils.getThirdPoint(i,h,o.Constants.HALF_PI,s,!0),n=o.PlotUtils.getThirdPoint(h,l,o.Constants.HALF_PI,a,!1)),n},v.algorithm.tailedAttackArrow=function(i){i=v.algorithm.dereplication(i),this.tailWidthFactor=b.tailWidthFactor,this.swallowTailFactor=b.swallowTailFactor,this.swallowTailPnt=b.swallowTailPnt;var r={controlPoint:null,polygonalPoint:null};r.controlPoint=i;var e=i.length;if(!(2>e)){if(i.length==2)return r.polygonalPoint=i,r;var n=i,s=n[0],a=n[1];o.PlotUtils.isClockWise(n[0],n[1],n[2])&&(s=n[1],a=n[0]);var l=o.PlotUtils.mid(s,a),h=[l].concat(n.slice(2)),c=v.algorithm.getAttackArrowHeadPoints(h,s,a,b),d=c[0],f=c[4],P=o.PlotUtils.distance(s,a),u=o.PlotUtils.getBaseLength(h),p=u*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=o.PlotUtils.getThirdPoint(h[1],h[0],0,p,!0);var g=P/u,w=v.algorithm.getAttackArrowBodyPoints(h,d,f,g),e=w.length,m=[s].concat(w.slice(0,e/2));m.push(d);var A=[a].concat(w.slice(e/2,e)),y=[];A.push(f),m=o.PlotUtils.getQBSplinePoints(m),A=o.PlotUtils.getQBSplinePoints(A),y=v.algorithm.array2Dto1D(m.concat(c,A.reverse(),[this.swallowTailPnt,m[0]])),r.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(y)}return r},v.algorithm.getAttackArrowHeadPoints=function(i,r,e,n){this.headHeightFactor=n.headHeightFactor,this.headTailFactor=n.headTailFactor,this.headWidthFactor=n.headWidthFactor,this.neckWidthFactor=n.neckWidthFactor,this.neckHeightFactor=n.neckHeightFactor;var s=o.PlotUtils.getBaseLength(i),a=s*this.headHeightFactor,l=i[i.length-1];s=o.PlotUtils.distance(l,i[i.length-2]);var h=o.PlotUtils.distance(r,e);a>h*this.headTailFactor&&(a=h*this.headTailFactor);var c=a*this.headWidthFactor,d=a*this.neckWidthFactor;a=a>s?s:a;var f=a*this.neckHeightFactor,P=o.PlotUtils.getThirdPoint(i[i.length-2],l,0,a,!0),u=o.PlotUtils.getThirdPoint(i[i.length-2],l,0,f,!0),p=o.PlotUtils.getThirdPoint(l,P,o.Constants.HALF_PI,c,!1),g=o.PlotUtils.getThirdPoint(l,P,o.Constants.HALF_PI,c,!0),w=o.PlotUtils.getThirdPoint(l,u,o.Constants.HALF_PI,d,!1),m=o.PlotUtils.getThirdPoint(l,u,o.Constants.HALF_PI,d,!0);return[w,p,l,g,m]},v.algorithm.getAttackArrowBodyPoints=function(i,r,e,n){for(var s=o.PlotUtils.wholeDistance(i),a=o.PlotUtils.getBaseLength(i),l=a*n,h=o.PlotUtils.distance(r,e),c=(l-h)/2,d=0,f=[],P=[],u=1;u<i.length-1;u++){var p=o.PlotUtils.getAngleOfThreePoints(i[u-1],i[u],i[u+1])/2;d+=o.PlotUtils.distance(i[u-1],i[u]);var g=(l/2-d/s*c)/Math.sin(p),w=o.PlotUtils.getThirdPoint(i[u-1],i[u],Math.PI-p,g,!0),m=o.PlotUtils.getThirdPoint(i[u-1],i[u],p,g,!1);f.push(w),P.push(m)}return f.concat(P)},v.algorithm.dereplication=function(i){var r=i[i.length-1],e=!1,n=[];return n=i.filter(function(s){if(s[0]!=r[0]&&s[1]!=r[1])return s;e=!0}),e&&n.push(r),n},v.algorithm.fineArrow=function(i,r){if(i.length<2||r.length<2)return;let e=M.tailWidthFactor,n=M.neckWidthFactor,s=M.headWidthFactor,a=M.headAngle,l=M.neckAngle;var h=[];h[0]=i,h[1]=r;var c=h[0],d=h[1],f=o.PlotUtils.getBaseLength(h),P=f*e,u=f*n,p=f*s,g=o.PlotUtils.getThirdPoint(d,c,o.Constants.HALF_PI,P,!0),w=o.PlotUtils.getThirdPoint(d,c,o.Constants.HALF_PI,P,!1),m=o.PlotUtils.getThirdPoint(c,d,a,p,!1),A=o.PlotUtils.getThirdPoint(c,d,a,p,!0),y=o.PlotUtils.getThirdPoint(c,d,l,u,!1),T=o.PlotUtils.getThirdPoint(c,d,l,u,!0),F=[];return F.push(g[0],g[1],y[0],y[1],m[0],m[1],d[0],d[1],A[0],A[1],T[0],T[1],w[0],w[1],c[0],c[1]),Cesium.Cartesian3.fromDegreesArray(F)};var L=function(i){this.type="StraightArrow",this.objId=Number(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.viewer=i,this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.pointImageUrl="/cesium-vue3-vite/images/point.png",this.fillMaterial=Cesium.Color.fromCssColorString("#0000FF").withAlpha(.8),this.outlineMaterial=new Cesium.PolylineDashMaterialProperty({dashLength:16,color:Cesium.Color.fromCssColorString("#f00").withAlpha(.7)}),this.positions=[],this.firstPoint=null,this.floatPoint=null,this.arrowEntity=null,this.state=-1,this.selectPoint=null,this.clickStep=0,this.modifyHandler=null};L.prototype={disable:function(){this.positions=[],this.firstPoint&&(this.viewer.entities.remove(this.firstPoint),this.firstPoint=null),this.floatPoint&&(this.viewer.entities.remove(this.floatPoint),this.floatPoint=null),this.arrowEntity&&(this.viewer.entities.remove(this.arrowEntity),this.arrowEntity=null),this.state=-1,this.handler&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.selectPoint&&(this.viewer.entities.remove(this.selectPoint),this.selectPoint=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.clickStep=0},disableHandler:function(){this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler&&!this.modifyHandler.isDestroyed()&&(this.modifyHandler.destroy(),this.modifyHandler=null)},startDraw:function(){var i=this;this.state=1,this.handler.setInputAction(function(r){var e;e=C(r.position,i.viewer),e&&(i.positions.length==0&&(i.firstPoint=i.creatPoint(e),i.firstPoint.type="firstPoint",i.floatPoint=i.creatPoint(e),i.floatPoint.type="floatPoint",i.positions.push(e)),i.positions.length==3&&(i.firstPoint.show=!1,i.floatPoint.show=!1,i.handler.destroy(),i.arrowEntity.objId=i.objId,i.state=-1),i.positions.push(e.clone()))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){if(!(i.positions.length<1)){var e;e=C(r.endPosition,i.viewer),e&&(i.floatPoint.position.setValue(e),i.positions.length>=2&&(Cesium.defined(i.arrowEntity)?(i.positions.pop(),i.positions.push(e)):(i.positions.push(e),i.arrowEntity=i.showArrowOnMap(i.positions))))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},startModify:function(){this.state=2,this.firstPoint.show=!0,this.floatPoint.show=!0;var i=this;this.clickStep=0,this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler.setInputAction(function(r){var e=i.viewer.scene.pick(r.position);if(Cesium.defined(e)&&e.id?(i.clickStep++,e.id.objId||(i.selectPoint=e.id)):(i.modifyHandler.destroy(),i.modifyHandler=null,i.firstPoint.show=!1,i.floatPoint.show=!1,i.state=-1),i.clickStep==2){i.clickStep=0;var n;if(n=C(r.position,i.viewer),!n)return;i.selectPoint&&(i.selectPoint.position.setValue(n),i.selectPoint=null)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.modifyHandler.setInputAction(function(r){if(i.selectPoint){var e;if(e=C(r.endPosition,i.viewer),!e)return;i.selectPoint.position.setValue(e),i.selectPoint.type=="firstPoint"&&(i.positions[1]=e),i.selectPoint.type=="floatPoint"&&(i.positions[2]=e)}else return},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},createByData:function(i){this.state=-1,this.positions=[];for(var r=[],e=0;e<i.length;e++){var n=Cesium.Cartesian3.fromDegrees(i[e][0],i[e][1]);r.push(n)}this.positions=r,this.firstPoint=this.creatPoint(this.positions[1]),this.firstPoint.type="firstPoint",this.floatPoint=this.creatPoint(this.positions[2]),this.floatPoint.type="floatPoint",this.arrowEntity=this.showArrowOnMap(this.positions),this.firstPoint.show=!1,this.floatPoint.show=!1,this.arrowEntity.objId=this.objId},clear:function(){this.state=0,this.firstPoint&&this.viewer.entities.remove(this.firstPoint),this.floatPoint&&this.viewer.entities.remove(this.floatPoint),this.arrowEntity&&this.viewer.entities.remove(this.arrowEntity),this.state=-1},getLnglats:function(){for(var i=[],r=0;r<this.positions.length;r++){var e=this.cartesianToLatlng(this.positions[r]);i.push(e)}return i},getPositions:function(){return this.positions},creatPoint:function(i){var r=this.viewer.entities.add({position:i,billboard:{image:this.pointImageUrl,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY}});return r.attr="editPoint",r},showArrowOnMap:function(i){var r=this,e=function(){if(i.length<2)return null;var n=i[1],s=i[2],a=r.cartesianToLatlng(n),l=r.cartesianToLatlng(s),h=[],c=v.algorithm.fineArrow([a[0],a[1]],[l[0],l[1]]),d=JSON.stringify(c).indexOf("null");if(d!=-1)return[];for(var f=0;f<c.length;f++){var P=new Cesium.Cartesian3(c[f].x,c[f].y,c[f].z);h.push(P)}return new Cesium.PolygonHierarchy(h)};return this.viewer.entities.add({polygon:new Cesium.PolygonGraphics({hierarchy:new Cesium.CallbackProperty(e,!1),show:!0,fill:!0,material:r.fillMaterial})})},cartesianToLatlng:function(i){var r=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(i),e=Cesium.Math.toDegrees(r.latitude),n=Cesium.Math.toDegrees(r.longitude);return[n,e]}};var O=function(i){this.type="AttackArrow",this.objId=Number(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.viewer=i,this.pointImageUrl="/cesium-vue3-vite/images/point.png",this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.fillMaterial=Cesium.Color.RED.withAlpha(.8),this.outlineMaterial=new Cesium.PolylineDashMaterialProperty({dashLength:16,color:Cesium.Color.fromCssColorString("#f00").withAlpha(.7)}),this.positions=[],this.state=-1,this.floatPoint=null,this.arrowEntity=null,this.pointArr=[],this.selectPoint=null,this.clickStep=0,this.modifyHandler=null};O.prototype={disable:function(){this.positions=[],this.arrowEntity&&(this.viewer.entities.remove(this.arrowEntity),this.arrowEntity=null),this.state=-1,this.handler&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.floatPoint&&(this.viewer.entities.remove(this.floatPoint),this.floatPoint=null),this.selectPoint&&(this.viewer.entities.remove(this.selectPoint),this.selectPoint=null);for(var i=0;i<this.pointArr.length;i++)this.pointArr[i]&&this.viewer.entities.remove(this.pointArr[i]);this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.clickStep=0},disableHandler:function(){this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler&&!this.modifyHandler.isDestroyed()&&(this.modifyHandler.destroy(),this.modifyHandler=null)},startDraw:function(){var i=this;this.state=1,this.handler.setInputAction(function(r){var e;if(e=C(r.position,i.viewer),!!e){i.positions.length==0&&(i.floatPoint=i.creatPoint(e),i.floatPoint.wz=-1),i.positions.push(e);var n=i.creatPoint(e);i.positions.length>2?n.wz=i.positions.length-1:n.wz=i.positions.length,i.pointArr.push(n)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){if(!(i.positions.length<2)){var e;e=C(r.endPosition,i.viewer),e&&(i.floatPoint.position.setValue(e),i.positions.length>=2&&(Cesium.defined(i.arrowEntity)?(i.positions.pop(),i.positions.push(e)):(i.positions.push(e),i.arrowEntity=i.showArrowOnMap(i.positions),i.arrowEntity.objId=i.objId)))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(r){var e;if(e=C(r.position,i.viewer),!!e){for(var n=0;n<i.pointArr.length;n++)i.pointArr[n].show=!1;i.floatPoint.show=!1,i.viewer.entities.remove(i.floatPoint),i.floatPoint=null;var s=i.creatPoint(e);s.show=!1,s.wz=i.positions.length,i.pointArr.push(s),i.handler.destroy()}},Cesium.ScreenSpaceEventType.RIGHT_CLICK)},createByData:function(i){this.positions=[],this.state=-1,this.floatPoint=null,this.pointArr=[],this.selectPoint=null,this.clickStep=0,this.modifyHandler=null;for(var r=[],e=0;e<i.length;e++){var n=Cesium.Cartesian3.fromDegrees(i[e][0],i[e][1]);r.push(n)}this.positions=r;for(var e=0;e<this.positions.length;e++){var s=this.creatPoint(this.positions[e]);s.show=!1,s.wz=e+1,this.pointArr.push(s)}this.arrowEntity=this.showArrowOnMap(this.positions),this.arrowEntity.objId=this.objId},startModify:function(){this.state=2;for(var i=this,r=0;r<i.pointArr.length;r++)i.pointArr[r].show=!0;this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler.setInputAction(function(e){var n=i.viewer.scene.pick(e.position);if(Cesium.defined(n)&&n.id)i.clickStep++,n.id.objId||(i.selectPoint=n.id);else{for(var s=0;s<i.pointArr.length;s++)i.pointArr[s].show=!1;i.floatPoint&&(i.floatPoint.show=!1),i.state=-1,i.modifyHandler.destroy(),i.modifyHandler=null}if(i.clickStep==2){i.clickStep=0;var a;if(a=C(e.position,i.viewer),!a)return;i.selectPoint&&(i.selectPoint.position.setValue(a),i.selectPoint=null)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.modifyHandler.setInputAction(function(e){var n;if(n=C(e.endPosition,i.viewer),!!n)if(i.selectPoint)i.selectPoint.position.setValue(n),i.positions[i.selectPoint.wz-1]=n;else return},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},clear:function(){this.state=0;for(var i=0;i<this.pointArr.length;i++)this.pointArr[i]&&this.viewer.entities.remove(this.pointArr[i]);this.floatPoint&&this.viewer.entities.remove(this.floatPoint),this.arrowEntity&&this.viewer.entities.remove(this.arrowEntity),this.state=-1},getLnglats:function(){for(var i=[],r=0;r<this.positions.length;r++){var e=this.cartesianToLatlng(this.positions[r]);i.push(e)}return i},getPositions:function(){return this.positions},creatPoint:function(i){var r=this.viewer.entities.add({position:i,billboard:{image:this.pointImageUrl,verticalOrigin:Cesium.VerticalOrigin.BOTTOM}});return r.attr="editPoint",r},showArrowOnMap:function(i){var r=this,e=function(){if(i.length<3)return null;for(var n=[],s=0;s<i.length;s++){var a=r.cartesianToLatlng(i[s]);n.push(a)}var l=v.algorithm.tailedAttackArrow(n),h=JSON.stringify(l.polygonalPoint).indexOf("null"),c=[];return h==-1&&(c=l.polygonalPoint),new Cesium.PolygonHierarchy(c)};return this.viewer.entities.add({polygon:new Cesium.PolygonGraphics({hierarchy:new Cesium.CallbackProperty(e,!1),show:!0,fill:!0,material:r.fillMaterial})})},cartesianToLatlng:function(i){var r=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(i),e=Cesium.Math.toDegrees(r.latitude),n=Cesium.Math.toDegrees(r.longitude);return[n,e]}};var _=function(i){this.type="PincerArrow",this.objId=Number(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.viewer=i,this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.pointImageUrl="/cesium-vue3-vite/images/point.png",this.fillMaterial=Cesium.Color.YELLOW.withAlpha(.8),this.outlineMaterial=new Cesium.PolylineDashMaterialProperty({dashLength:16,color:Cesium.Color.fromCssColorString("#f00").withAlpha(.7)}),this.positions=[],this.state=-1,this.floatPoint=null,this.pointArr=[],this.selectPoint=null,this.clickStep=0,this.modifyHandler=null};_.prototype={disable:function(){this.positions=[],this.arrowEntity&&(this.viewer.entities.remove(this.arrowEntity),this.arrowEntity=null),this.state=-1,this.handler&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.floatPoint&&(this.viewer.entities.remove(this.floatPoint),this.floatPoint=null),this.selectPoint&&(this.viewer.entities.remove(this.selectPoint),this.selectPoint=null);for(var i=0;i<this.pointArr.length;i++)this.pointArr[i]&&this.viewer.entities.remove(this.pointArr[i]);this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.clickStep=0},disableHandler:function(){this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler&&!this.modifyHandler.isDestroyed()&&(this.modifyHandler.destroy(),this.modifyHandler=null)},startDraw:function(){var i=this;this.state=1,this.handler.setInputAction(function(r){var e;if(e=C(r.position,i.viewer),!!e)if(i.positions.length==0&&(i.floatPoint=i.creatPoint(e)),i.positions.length>4){var n=i.creatPoint(e);n.wz=i.positions.length,i.pointArr.push(n);for(var s=0;s<i.pointArr.length;s++)i.pointArr[s].show=!1;i.floatPoint&&(i.floatPoint.show=!1,i.viewer.entities.remove(i.floatPoint),i.floatPoint=null),i.handler.destroy();return}else{i.positions.push(e);var n=i.creatPoint(e);i.positions.length>2?n.wz=i.positions.length-1:n.wz=i.positions.length,i.pointArr.push(n)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){if(!(i.positions.length<2)){var e;e=C(r.endPosition,i.viewer),e&&(i.floatPoint.position.setValue(e),i.positions.length>=2&&(Cesium.defined(i.arrowEntity)?(i.positions.pop(),i.positions.push(e)):(i.positions.push(e),i.arrowEntity=i.showArrowOnMap(i.positions),i.arrowEntity.objId=i.objId)))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},createByData:function(i){this.positions=[],this.state=-1,this.floatPoint=null,this.pointArr=[],this.selectPoint=null,this.clickStep=0,this.modifyHandler=null;for(var r=[],e=0;e<i.length;e++){var n=Cesium.Cartesian3.fromDegrees(i[e][0],i[e][1]);r.push(n)}this.positions=r;for(var e=0;e<this.positions.length;e++){var s=this.creatPoint(this.positions[e]);s.show=!1,s.wz=e+1,this.pointArr.push(s)}this.arrowEntity=this.showArrowOnMap(this.positions),this.arrowEntity.objId=this.objId},startModify:function(){this.state=2;for(var i=this,r=0;r<i.pointArr.length;r++)i.pointArr[r].show=!0;this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.modifyHandler.setInputAction(function(e){var n=i.viewer.scene.pick(e.position);if(Cesium.defined(n)&&n.id)i.clickStep++,n.id.objId||(i.selectPoint=n.id);else{for(var s=0;s<i.pointArr.length;s++)i.pointArr[s].show=!1;i.state=-1,i.modifyHandler.destroy(),i.modifyHandler=null}if(i.clickStep==2){i.clickStep=0;var a;if(a=C(e.position,i.viewer),!a)return;i.selectPoint&&(i.selectPoint.position.setValue(a),i.selectPoint=null)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.modifyHandler.setInputAction(function(e){var n;if(n=C(e.endPosition,i.viewer),!!n)if(i.selectPoint)i.selectPoint.position.setValue(n),i.positions[i.selectPoint.wz-1]=n;else return},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},clear:function(){this.state=0;for(var i=0;i<this.pointArr.length;i++)this.pointArr[i]&&this.viewer.entities.remove(this.pointArr[i]);this.floatPoint&&this.viewer.entities.remove(this.floatPoint),this.arrowEntity&&this.viewer.entities.remove(this.arrowEntity),this.state=-1},getLnglats:function(){for(var i=[],r=0;r<this.positions.length;r++){var e=this.cartesianToLatlng(this.positions[r]);i.push(e)}return i},getPositions:function(){return this.positions},creatPoint:function(i){return this.viewer.entities.add({position:i,billboard:{image:this.pointImageUrl,verticalOrigin:Cesium.VerticalOrigin.BOTTOM}})},showArrowOnMap:function(i){var r=this,e=function(){if(i.length<3)return null;for(var n=[],s=0;s<i.length;s++){var a=r.cartesianToLatlng(i[s]);n.push(a)}var l=v.algorithm.doubleArrow(n),h=[],c=JSON.stringify(l.polygonalPoint).indexOf("null");return c==-1&&(h=l.polygonalPoint),new Cesium.PolygonHierarchy(h)};return this.viewer.entities.add({polygon:new Cesium.PolygonGraphics({hierarchy:new Cesium.CallbackProperty(e,!1),show:!0,fill:!0,material:r.fillMaterial})})},cartesianToLatlng:function(i){var r=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(i),e=Cesium.Math.toDegrees(r.latitude),n=Cesium.Math.toDegrees(r.longitude);return[n,e]}};function C(i,r){for(var e=r.scene.drillPick(i),n,s=!0,a=0;a<e.length;a++)(e[a]&&e[a].primitive||e[a]instanceof Cesium.Cesium3DTileFeature)&&(s=!0);if(s)n=r.scene.pickPosition(i);else{var l=r.camera.getPickRay(i);if(!l)return null;n=r.scene.globe.pick(l,r.scene)}return n}const H={isActivate:!1,drawArr:[],handler:null,viewer:null,init:function(i){this.isActivate||(this.isActivate=!0,this.viewer=i,this.bindEdit())},disable:function(){if(this.isActivate){this.isActivate=!1;for(var i=0;i<this.drawArr.length;i++)this.drawArr[i].disable();this.drawArr=[],this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=null),this.viewer=null}},draw:function(i){for(var r=0;r<this.drawArr.length;r++)this.drawArr[r].disableHandler();switch(i){case"straightArrow":var e=new L(this.viewer);e.disable(),e.startDraw(),this.drawArr.push(e);break;case"attackArrow":var n=new O(this.viewer);n.startDraw(),this.drawArr.push(n);break;case"pincerArrow":var s=new _(this.viewer);s.startDraw(),this.drawArr.push(s)}},saveData:function(){for(var i={straightArrowData:[],attackArrowData:[],pincerArrowData:[]},r=0;r<this.drawArr.length;r++){var e=this.drawArr[r],n=e.getLnglats();e.type=="StraightArrow"?i.straightArrowData.push(n):e.type=="AttackArrow"?i.attackArrowData.push(n):i.pincerArrowData.push(n)}console.log("\u4FDD\u5B58\u7684\u6570\u636E\uFF1A"+JSON.stringify(i))},showData:function(i){if(!!i){for(var r=i.straightArrowData,e=i.attackArrowData,n=i.pincerArrowData,s=0;s<r.length;s++){var a=r[s],l=new L(this.viewer);l.createByData(a),this.drawArr.push(l)}for(var h=0;h<e.length;h++){var a=e[h],c=new O(this.viewer);c.createByData(a),this.drawArr.push(c)}for(var d=0;d<n.length;d++){var a=n[d],f=new _(this.viewer);f.createByData(a),this.drawArr.push(f)}}},nowArrowObj:null,bindEdit:function(){var i=this;this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(r){var e=i.viewer.scene.pick(r.position);if(console.log("\u5355\u51FB\u5F00\u59CB\u7ED8\u5236pick",e),Cesium.defined(e)&&e.id){if(i.nowArrowObj&&i.nowArrowObj.state!=-1){console.log("\u4E0A\u4E00\u6B65\u64CD\u4F5C\u672A\u7ED3\u675F\uFF0C\u8BF7\u7EE7\u7EED\u5B8C\u6210\u4E0A\u4E00\u6B65\uFF01");return}console.log("drawArr",i.drawArr);for(var n=0;n<i.drawArr.length;n++)if(e.id.objId==i.drawArr[n].objId){i.nowArrowObj=i.drawArr[n],i.drawArr[n].startModify();break}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},clearOne:function(){var i=this;this.handler.setInputAction(function(r){var e=i.viewer.scene.pick(r.position);if(Cesium.defined(e)&&e.id){for(var n=0;n<i.drawArr.length;n++)if(e.id.objId==i.drawArr[n].objId){i.drawArr[n].clear(),i.drawArr.splice(n,1);break}i.handler.destroy(),i.bindEdit()}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},clearAll:function(){for(var i=0;i<this.drawArr.length;i++)this.drawArr[i].clear()}},K={__name:"arrow",setup(i){const r=B(),{viewer:e}=r.state;N(()=>{e.scene.terrainProvider=new Cesium.CesiumTerrainProvider({url:"http://data.marsgis.cn/terrain"}),H.disable(),H.init(e)});const n=()=>{H.draw("straightArrow")},s=()=>{H.draw("attackArrow")},a=()=>{H.draw("pincerArrow")},l=()=>{H.clearAll()};return V(()=>{l(),e.scene.terrainProvider=new Cesium.EllipsoidTerrainProvider({})}),(h,c)=>{const d=x,f=W;return j(),z(f,null,{default:E(()=>[S(d,{type:"primary",onClick:n},{default:E(()=>c[0]||(c[0]=[k("\u76F4\u7EBF\u7BAD\u5934")])),_:1}),S(d,{type:"primary",onClick:s},{default:E(()=>c[1]||(c[1]=[k("\u653B\u51FB\u7BAD\u5934")])),_:1}),S(d,{type:"primary",onClick:a},{default:E(()=>c[2]||(c[2]=[k("\u94B3\u51FB\u7BAD\u5934")])),_:1}),S(d,{type:"primary",onClick:l},{default:E(()=>c[3]||(c[3]=[k("\u6E05\u9664")])),_:1})]),_:1})}}};export{K as default};
