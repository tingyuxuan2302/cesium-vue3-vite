class p{constructor(e,r={}){e&&e instanceof Cesium.Viewer&&(this._drawLayer=new Cesium.CustomDataSource("measureLayer"),e&&e.dataSources.add(this._drawLayer),this._basePath=r.basePath||"",this._viewer=e)}transformWGS84ToCartesian(e,r){if(this._viewer)return e?Cesium.Cartesian3.fromDegrees(e.lng||e.lon,e.lat,e.alt=r||e.alt,Cesium.Ellipsoid.WGS84):Cesium.Cartesian3.ZERO}transformWGS84ArrayToCartesianArray(e,r){if(this._viewer&&e){var a=this;return e?e.map(function(t){return a.transformWGS84ToCartesian(t,r)}):[]}}transformCartesianToWGS84(e){if(this._viewer&&e){var r=Cesium.Ellipsoid.WGS84,a=r.cartesianToCartographic(e);return{lng:Cesium.Math.toDegrees(a.longitude),lat:Cesium.Math.toDegrees(a.latitude),alt:a.height}}}transformCartesianArrayToWGS84Array(e){if(this._viewer){var r=this;return e?e.map(function(a){return r.transformCartesianToWGS84(a)}):[]}}transformWGS84ToCartographic(e){return e?Cesium.Cartographic.fromDegrees(e.lng||e.lon,e.lat,e.alt):Cesium.Cartographic.ZERO}getCatesian3FromPX(e){if(this._viewer&&e){var r=this._viewer.scene.drillPick(e),a=null,t=!1,i=!1;for(let u in r){let n=r[u];if((n&&n.primitive instanceof Cesium.Cesium3DTileFeature||n&&n.primitive instanceof Cesium.Cesium3DTileset||n&&n.primitive instanceof Cesium.Model)&&(t=!0),t&&(this._viewer.scene.pick(e),a=this._viewer.scene.pickPosition(e),a)){let C=Cesium.Cartographic.fromCartesian(a);C.height<0&&(C.height=0);let s=Cesium.Math.toDegrees(C.longitude),f=Cesium.Math.toDegrees(C.latitude),c=C.height;a=this.transformWGS84ToCartesian({lng:s,lat:f,alt:c})}}let l=this._viewer.terrainProvider instanceof Cesium.EllipsoidTerrainProvider;if(!t&&!l){var o=this._viewer.scene.camera.getPickRay(e);if(!o)return null;a=this._viewer.scene.globe.pick(o,this._viewer.scene),i=!0}if(!t&&!i&&l&&(a=this._viewer.scene.camera.pickEllipsoid(e,this._viewer.scene.globe.ellipsoid)),a){let u=this.transformCartesianToWGS84(a);return u.alt<0&&(a=this.transformWGS84ToCartesian(u,.1)),a}return!1}}getPositionDistance(e){let r=0;for(let a=0;a<e.length-1;a++){let t=this.transformWGS84ToCartographic(e[a]),i=this.transformWGS84ToCartographic(e[a+1]),o=new Cesium.EllipsoidGeodesic;o.setEndPoints(t,i);let l=o.surfaceDistance;l=Math.sqrt(Math.pow(l,2)+Math.pow(i.height-t.height,2)),r=r+l}return r.toFixed(3)}getPositionsArea(e){let r=0;if(e){let a=0,t=Cesium.Ellipsoid.WGS84;e.push(e[0]);for(let i=1;i<e.length;i++){let o=t.cartographicToCartesian(this.transformWGS84ToCartographic(e[i-1])),l=t.cartographicToCartesian(this.transformWGS84ToCartographic(e[i]));a+=o.x*l.y-l.x*o.y}r=Math.abs(a).toFixed(2)}return r}drawLineMeasureGraphics(e={}){if(this._viewer&&e){let l=function(u){var n=new Cesium.Entity;n.position=u,n.point={pixelSize:10,outlineColor:Cesium.Color.BLUE,outlineWidth:5},n.label={text:(t.getPositionDistance(t.transformCartesianArrayToWGS84Array(r))/1e3).toFixed(4)+"\u516C\u91CC",show:!0,showBackground:!0,font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-10,-10)},t._drawLayer.entities.add(n)};var r=[],a=new Cesium.Entity,t=this,i,o=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);o.setInputAction(function(u){var n=t.getCatesian3FromPX(u.position);n&&n.x&&(r.length==0&&r.push(n.clone()),l(n),r.push(n))},Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(u){var n=t.getCatesian3FromPX(u.endPosition);r.length>=2&&n&&n.x&&(r.pop(),r.push(n))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(u){o.destroy(),o=null;let n=t.getCatesian3FromPX(u.position);l(n),typeof e.callback=="function"&&e.callback(t.transformCartesianArrayToWGS84Array(r),i)},Cesium.ScreenSpaceEventType.RIGHT_CLICK),a.polyline={width:e.width||5,material:e.material||Cesium.Color.BLUE.withAlpha(.8),clampToGround:!1},a.polyline.positions=new Cesium.CallbackProperty(function(){return r},!1),i=this._drawLayer.entities.add(a)}}drawAreaMeasureGraphics(e={}){if(this._viewer&&e){let u=function(){t.polyline={width:3,material:Cesium.Color.BLUE.withAlpha(.8),clampToGround:e.clampToGround||!1},t.polyline.positions=new Cesium.CallbackProperty(function(){return r},!1),t.polygon={hierarchy:new Cesium.CallbackProperty(function(){return a},!1),material:Cesium.Color.WHITE.withAlpha(.1),clampToGround:e.clampToGround||!1},o=i._drawLayer.entities.add(t)},n=function(C){var s=new Cesium.Entity;s.position=C,s.point={pixelSize:10,outlineColor:Cesium.Color.BLUE,outlineWidth:5},s.label={text:(i.getPositionsArea(i.transformCartesianArrayToWGS84Array(r))/1e6).toFixed(4)+"\u5E73\u65B9\u516C\u91CC",show:!0,showBackground:!0,font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-10,-10)},i._drawLayer.entities.add(s)};var r=[],a=new Cesium.PolygonHierarchy,t=new Cesium.Entity,i=this,o=null,l=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);l.setInputAction(function(C){var s=i.getCatesian3FromPX(C.position);s&&s.x&&(r.length==0&&(a.positions.push(s.clone()),r.push(s.clone())),r.push(s.clone()),a.positions.push(s.clone()),o||u())},Cesium.ScreenSpaceEventType.LEFT_CLICK),l.setInputAction(function(C){var s=i.getCatesian3FromPX(C.endPosition);r.length>=2&&s&&s.x&&(r.pop(),r.push(s),a.positions.pop(),a.positions.push(s))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(C){i.getCatesian3FromPX(C.endPosition),l.destroy(),r.push(r[0]),n(r[0]),typeof e.callback=="function"&&e.callback(i.transformCartesianArrayToWGS84Array(r),o)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}}drawTrianglesMeasureGraphics(e={}){if(e.style=e.style||{width:3,material:Cesium.Color.BLUE.withAlpha(.5)},this._viewer&&e){let C=function(f,c){if(!f&&!c||Cesium.Cartesian3.equals(f,c))return 0;let h=Cesium.Cartographic.fromCartesian(f);return(Cesium.Cartographic.fromCartesian(c).height-h.height).toFixed(2)},s=function(f){let c=Cesium.Cartographic.fromCartesian(f[0]),h=Cesium.Cartographic.fromCartesian(f[1]);return Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(c.longitude),Cesium.Math.toDegrees(c.latitude),h.height)};var r=new Cesium.Entity,a=new Cesium.Entity,t=new Cesium.Entity,i=[],o=[],l=[],u=this,n=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);n.setInputAction(function(f){var c=u.getCatesian3FromPX(f.position);if(!c&&!c.z)return!1;i.length==0?(i.push(c.clone()),i.push(c.clone()),o.push(c.clone()),o.push(c.clone())):(n.destroy(),typeof e.callback=="function"&&e.callback({e:r,e2:a,e3:t}))},Cesium.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(f){var c=u.getCatesian3FromPX(f.endPosition);if(c&&i.length>0){i.pop(),i.push(c.clone());let h=s(i);o.pop(),o.push(h.clone()),l.pop(),l.pop(),l.push(c.clone()),l.push(h.clone())}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),r.polyline={positions:new Cesium.CallbackProperty(function(){return i},!1),...e.style},r.position=new Cesium.CallbackProperty(function(){return i[0]},!1),r.point={pixelSize:5,outlineColor:Cesium.Color.BLUE,outlineWidth:5},r.label={text:new Cesium.CallbackProperty(function(){return"\u76F4\u7EBF:"+u.getPositionDistance(u.transformCartesianArrayToWGS84Array(i))+"\u7C73"},!1),show:!0,showBackground:!0,font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(50,-100)},a.polyline={positions:new Cesium.CallbackProperty(function(){return o},!1),...e.style},a.position=new Cesium.CallbackProperty(function(){return l[1]},!1),a.point={pixelSize:5,outlineColor:Cesium.Color.BLUE,outlineWidth:5},a.label={text:new Cesium.CallbackProperty(function(){return"\u9AD8\u5EA6:"+C(o[0],o[1])+"\u7C73"},!1),show:!0,showBackground:!0,font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-20,100)},t.polyline={positions:new Cesium.CallbackProperty(function(){return l},!1),...e.style},t.position=new Cesium.CallbackProperty(function(){return i[1]},!1),t.point={pixelSize:5,outlineColor:Cesium.Color.BLUE,outlineWidth:5},t.label={text:new Cesium.CallbackProperty(function(){return"\u6C34\u5E73\u8DDD\u79BB:"+u.getPositionDistance(u.transformCartesianArrayToWGS84Array(l))+"\u7C73"},!1),show:!0,showBackground:!0,font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-150,-20)},this._drawLayer.entities.add(t),this._drawLayer.entities.add(a),this._drawLayer.entities.add(r)}}}export{p as M};
