import{_ as b}from"./OperateBox.66cb383c.js";import{u as w,j as v,a as x,o as k,c as E,w as l,d,e as u}from"./index.bc967ea1.js";import{E as B}from"./el-button.3d1567a4.js";import{D}from"./dialog.14637df4.js";const L={__name:"combine",setup(O){const p=w(),a=v(),{viewer:s}=p.state,g=()=>{s.dataSources.add(new Cesium.GeoJsonDataSource().load("/cesium-vue3-vite/json/chuzhong.geojson").then(e=>(e.clustering.enabled=!0,e.clustering.pixelRange=60,e.clustering.minimumClusterSize=2,e.entities.values.forEach(n=>{n.position._value.z+=2e3,n._id=`mark-${n.id}`,n.billboard={image:"/cesium-vue3-vite/images/mark-icon.png",width:32,height:32}}),e.clustering.clusterEvent.addEventListener((n,o)=>{o.label.show=!1,o.billboard.show=!0,o.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,console.log("clusteredEntities",n),console.log("cluster",o),o.billboard.image=C("/cesium-vue3-vite/images/mark-icon.png",n.length,64),o.billboard.width=40,o.billboard.height=40}),e)))};function C(e,n,o){let t=document.createElement("canvas");t.width=o,t.height=o;let i=t.getContext("2d");return new Cesium.Resource.fetchImage(e).then(h=>{try{i.drawImage(h,0,0)}catch(_){console.log(_)}return i.fillStyle=Cesium.Color.BLACK.toCssColorString(),i.font="bold 20px Microsoft YaHei",i.textAlign="center",i.textBaseline="middle",i.fillText(n,o/2,o/2),t})}s.camera.setView({destination:Cesium.Cartesian3.fromDegrees(120.36,36.09,4e4)});const c=s.scene;new Cesium.ScreenSpaceEventHandler(c.canvas).setInputAction(e=>{var i;const n=s.scene.camera.pickEllipsoid(e.position),o=Cesium.Cartographic.fromCartesian(n),t=c.pick(e.position);if(Cesium.defined(t)&&((i=t.id)==null?void 0:i.id.indexOf("mark"))>-1){s.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),1e4),duration:1});const r=Object.assign(t.id,{viewer:s,title:t.id.name,content:t.id.properties.address._value});console.log("---",t.id,r),a.value&&a.value.windowClose(),a.value=new D(r)}},Cesium.ScreenSpaceEventType.LEFT_CLICK);const f=()=>{var e;(e=a.value)==null||e.windowClose()},m=()=>{var e;f(),(e=s.dataSources)==null||e.removeAll()};return x(()=>{m()}),(e,n)=>{const o=B,t=b;return k(),E(t,null,{default:l(()=>[d(o,{type:"primary",onClick:g},{default:l(()=>n[0]||(n[0]=[u("\u6253\u70B9")])),_:1}),d(o,{type:"primary",onClick:m},{default:l(()=>n[1]||(n[1]=[u("\u6E05\u9664\u6253\u70B9")])),_:1})]),_:1})}}};export{L as default};
