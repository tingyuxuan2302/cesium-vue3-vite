import{_ as b}from"./OperateBox.9c1989a1.js";import{u as w,f as v,a as x,o as k,c as E,w as l,d,e as u}from"./index.f73e044e.js";import{E as B}from"./el-button.456a72d6.js";import{D}from"./dialog.e97c9ea8.js";const L={__name:"combine",setup(O){const p=w(),a=v(),{viewer:s}=p.state,g=()=>{s.dataSources.add(new Cesium.GeoJsonDataSource().load("/json/chuzhong.geojson").then(e=>(e.clustering.enabled=!0,e.clustering.pixelRange=60,e.clustering.minimumClusterSize=2,e.entities.values.forEach(t=>{t.position._value.z+=2e3,t._id=`mark-${t.id}`,t.billboard={image:"/images/mark-icon.png",width:32,height:32}}),e.clustering.clusterEvent.addEventListener((t,o)=>{o.label.show=!1,o.billboard.show=!0,o.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,console.log("clusteredEntities",t),console.log("cluster",o),o.billboard.image=C("/images/mark-icon.png",t.length,64),o.billboard.width=40,o.billboard.height=40}),e)))};function C(e,t,o){let n=document.createElement("canvas");n.width=o,n.height=o;let i=n.getContext("2d");return new Cesium.Resource.fetchImage(e).then(h=>{try{i.drawImage(h,0,0)}catch(_){console.log(_)}return i.fillStyle=Cesium.Color.BLACK.toCssColorString(),i.font="bold 20px Microsoft YaHei",i.textAlign="center",i.textBaseline="middle",i.fillText(t,o/2,o/2),n})}s.camera.setView({destination:Cesium.Cartesian3.fromDegrees(120.36,36.09,4e4)});const c=s.scene;new Cesium.ScreenSpaceEventHandler(c.canvas).setInputAction(e=>{var i;const t=s.scene.camera.pickEllipsoid(e.position),o=Cesium.Cartographic.fromCartesian(t),n=c.pick(e.position);if(Cesium.defined(n)&&((i=n.id)==null?void 0:i.id.indexOf("mark"))>-1){s.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),1e4),duration:1});const r=Object.assign(n.id,{viewer:s,title:n.id.name,content:n.id.properties.address._value});console.log("---",n.id,r),a.value&&a.value.windowClose(),a.value=new D(r)}},Cesium.ScreenSpaceEventType.LEFT_CLICK);const f=()=>{var e;(e=a.value)==null||e.windowClose()},m=()=>{var e;f(),(e=s.dataSources)==null||e.removeAll()};return x(()=>{m()}),(e,t)=>{const o=B,n=b;return k(),E(n,null,{default:l(()=>[d(o,{type:"primary",onClick:g},{default:l(()=>[u("\u6253\u70B9")]),_:1}),d(o,{type:"primary",onClick:m},{default:l(()=>[u("\u6E05\u9664\u6253\u70B9")]),_:1})]),_:1})}}};export{L as default};
