import{_}from"./OperateBox.5dea2f2a.js";import{h as b,a as w,o as v,c as x,w as r,d,e as u}from"./index.76f76e18.js";import{E as k}from"./el-button.46cdb001.js";import{D as E}from"./dialog.a48f0aca.js";const I={__name:"combine",setup(B){const a=b(),{viewer:s}=window,p=()=>{s.dataSources.add(new Cesium.GeoJsonDataSource().load("/cesium-vue3-vite/json/chuzhong.geojson").then(e=>(e.clustering.enabled=!0,e.clustering.pixelRange=60,e.clustering.minimumClusterSize=2,e.entities.values.forEach(n=>{n.position._value.z+=2e3,n._id=`mark-${n.id}`,n.billboard={image:"/cesium-vue3-vite/images/mark-icon.png",width:32,height:32}}),e.clustering.clusterEvent.addEventListener((n,o)=>{o.label.show=!1,o.billboard.show=!0,o.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,console.log("clusteredEntities",n),console.log("cluster",o),o.billboard.image=g("/cesium-vue3-vite/images/mark-icon.png",n.length,64),o.billboard.width=40,o.billboard.height=40}),e)))};function g(e,n,o){let t=document.createElement("canvas");t.width=o,t.height=o;let i=t.getContext("2d");return new Cesium.Resource.fetchImage(e).then(f=>{try{i.drawImage(f,0,0)}catch(h){console.log(h)}return i.fillStyle=Cesium.Color.BLACK.toCssColorString(),i.font="bold 20px Microsoft YaHei",i.textAlign="center",i.textBaseline="middle",i.fillText(n,o/2,o/2),t})}s.camera.setView({destination:Cesium.Cartesian3.fromDegrees(120.36,36.09,4e4)});const c=s.scene;new Cesium.ScreenSpaceEventHandler(c.canvas).setInputAction(e=>{var i;const n=s.scene.camera.pickEllipsoid(e.position),o=Cesium.Cartographic.fromCartesian(n),t=c.pick(e.position);if(Cesium.defined(t)&&((i=t.id)==null?void 0:i.id.indexOf("mark"))>-1){s.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),1e4),duration:1});const l=Object.assign(t.id,{viewer:s,title:t.id.name,content:t.id.properties.address._value});console.log("---",t.id,l),a.value&&a.value.windowClose(),a.value=new E(l)}},Cesium.ScreenSpaceEventType.LEFT_CLICK);const C=()=>{var e;(e=a.value)==null||e.windowClose()},m=()=>{var e;C(),(e=s.dataSources)==null||e.removeAll()};return w(()=>{m()}),(e,n)=>{const o=k,t=_;return v(),x(t,null,{default:r(()=>[d(o,{type:"primary",onClick:p},{default:r(()=>n[0]||(n[0]=[u("\u6253\u70B9")])),_:1}),d(o,{type:"primary",onClick:m},{default:r(()=>n[1]||(n[1]=[u("\u6E05\u9664\u6253\u70B9")])),_:1})]),_:1})}}};export{I as default};
