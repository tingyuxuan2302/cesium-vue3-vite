import{o as R,b as L}from"./index.f76e180b.js";/*!
 * author: joe <qj5657@gmail.com>
 * cesium-wind 1.0.3
 * build-time: 2020-9-23 11:17
 * LICENSE: MIT
 * (c) 2020-2020 https://github.com/QJvic/cesium-wind
 */(function(d,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("cesium/Cesium")):typeof define=="function"&&define.amd?define(["exports","cesium/Cesium"],g):(d=typeof globalThis<"u"?globalThis:d||self,g(d.CesiumWind={},d.Cesium))})(globalThis,function(d){/*!
 * author: sakitam-fdd <smilefdd@gmail.com>
 * wind-core v1.0.0-alpha.9
 * build-time: 2020-7-5 23:35
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 *//*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function g(){for(var n=arguments,t=0,i=0,e=arguments.length;i<e;i++)t+=n[i].length;for(var r=Array(t),s=0,i=0;i<e;i++)for(var o=arguments[i],a=0,h=o.length;a<h;a++,s++)r[s]=o[a];return r}Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"}),typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(t,i){var e=arguments;if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),s=1;s<arguments.length;s++){var o=e[s];if(o!=null)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},writable:!0,configurable:!0});var w=Object.prototype.hasOwnProperty,u=typeof Symbol<"u"?Symbol.toStringTag:void 0;function j(n){if(n===null)return n===void 0?"[object Undefined]":"[object Null]";if(!(u&&u in Object(n)))return toString.call(n);var t=w.call(n,u),i=n[u],e=!1;try{n[u]=void 0,e=!0}catch{}var r=Object.prototype.toString.call(n);return e&&(t?n[u]=i:delete n[u]),r}function y(n){if(!I(n))return!1;var t=j(n);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function I(n){var t=typeof n;return n!==null&&(t==="object"||t==="function")}function W(n){return n==null?!1:typeof n=="string"||n.constructor!==null&&n.constructor===String}function b(n){return Object.prototype.toString.call(n)==="[object Number]"&&!isNaN(n)}function D(n){return Array.isArray(n)}function V(n){for(var t=arguments,i=[],e=1;e<arguments.length;e++)i[e-1]=t[e];return Object.assign.apply(Object,g([n],i))}function F(n,t){return n-t*Math.floor(n/t)}function p(n){return n!=null&&!isNaN(n)}function T(n){var t,i;if(console.time("format-data"),n.forEach(function(s){switch(s.header.parameterCategory+","+s.header.parameterNumber){case"1,2":case"2,2":t=s;break;case"1,3":case"2,3":i=s;break}}),!(!i||!t)){var e=t.header,r=new C({xmin:e.lo1,ymin:e.la1,xmax:e.lo2,ymax:e.la2,deltaX:e.dx,deltaY:e.dy,cols:e.nx,rows:e.ny,us:t.data,vs:i.data});return console.timeEnd("format-data"),r}}function _(n){return n?(n.parentNode&&n.parentNode.removeChild(n),n):null}var S=function(){function n(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return n.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},n.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v),i=t*(180/Math.PI);return i<0&&(i+=360),i},n.prototype.directionFrom=function(){var t=this.directionTo();return(t+180)%360},n}(),C=function(){function n(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaY<0&&this.ymin<this.ymax?console.warn("[wind-core]: The data is flipY"):(this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin)),this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),e=Math.ceil((this.ymax-this.ymin)/t.deltaY);(i!==this.cols||e!==this.rows)&&console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return n.prototype.buildGrid=function(){for(var t=[],i=0,e=this,r=e.rows,s=e.cols,o=e.us,a=e.vs,h=0;h<r;h++){for(var l=[],c=0;c<s;c++,i++){var f=o[i],v=a[i],m=this.isValid(f)&&this.isValid(v);l[c]=m?new S(f,v):null}this.isContinuous&&l.push(l[0]),t[h]=l}return t},n.prototype.release=function(){this.grid=[]},n.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},n.prototype.bilinearInterpolateVector=function(t,i,e,r,s,o){var a=1-t,h=1-i,l=a*h,c=t*h,f=a*i,v=t*i,m=e.u*l+r.u*c+s.u*f+o.u*v,x=e.v*l+r.v*c+s.v*f+o.v*v;return new S(m,x)},n.prototype.calculateRange=function(){if(!(!this.grid||!this.grid[0])){for(var t=this.grid.length,i=this.grid[0].length,e,r,s=0;s<t;s++)for(var o=0;o<i;o++){var a=this.grid[s][o];if(a!==null){var h=a.m||a.magnitude();e===void 0?e=h:r===void 0?(r=h,e=Math.min(e,r),r=Math.max(e,r)):(e=Math.min(h,e),r=Math.max(h,r))}}return[e,r]}},n.prototype.isValid=function(t){return t!=null},n.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},n.prototype.contains=function(t,i){var e=this.getWrappedLongitudes(),r=e[0],s=e[1],o=t>=r&&t<=s,a;return this.deltaY>=0?a=i>=this.ymin&&i<=this.ymax:a=i>=this.ymax&&i<=this.ymin,o&&a},n.prototype.getDecimalIndexes=function(t,i){var e=F(t-this.xmin,360)/this.deltaX,r=(this.ymax-i)/this.deltaY;return[e,r]},n.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),r=Math.floor(e[0]),s=Math.floor(e[1]),o=this.clampColumnIndex(r),a=this.clampRowIndex(s);return this.valueAtIndexes(o,a)},n.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),r=e[0],s=e[1];return this.interpolatePoint(r,s)},n.prototype.hasValueAt=function(t,i){var e=this.valueAt(t,i);return e!==null},n.prototype.interpolatePoint=function(t,i){var e=this.getFourSurroundingIndexes(t,i),r=e[0],s=e[1],o=e[2],a=e[3],h=this.getFourSurroundingValues(r,s,o,a);if(h){var l=h[0],c=h[1],f=h[2],v=h[3];return this.bilinearInterpolateVector(t-r,i-o,l,c,f,v)}return null},n.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var e=this.cols-1;return t>e&&(i=e),i},n.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var e=this.rows-1;return t>e&&(i=e),i},n.prototype.getFourSurroundingIndexes=function(t,i){var e=Math.floor(t),r=e+1;this.isContinuous&&r>=this.cols&&(r=0),r=this.clampColumnIndex(r);var s=this.clampRowIndex(Math.floor(i)),o=this.clampRowIndex(s+1);return[e,r,s,o]},n.prototype.getFourSurroundingValues=function(t,i,e,r){var s;if(s=this.grid[e]){var o=s[t],a=s[i];if(this.isValid(o)&&this.isValid(a)&&(s=this.grid[r])){var h=s[t],l=s[i];if(this.isValid(h)&&this.isValid(l))return[o,a,h,l]}}return null},n.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},n.prototype.lonLatAtIndexes=function(t,i){var e=this.longitudeAtX(t),r=this.latitudeAtY(i);return[e,r]},n.prototype.longitudeAtX=function(t){var i=this.deltaX/2,e=this.xmin+i+t*this.deltaX;return this.wrappedX&&(e=e>180?e-360:e),e},n.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},n.prototype.randomize=function(t,i,e,r){t===void 0&&(t={});var s=Math.random()*(i||this.cols)|0,o=Math.random()*(e||this.rows)|0,a=r([s,o]);return a!==null?(t.x=a[0],t.y=a[1]):(t.x=this.longitudeAtX(s),t.y=this.latitudeAtY(o)),t},n.prototype.checkFields=function(){return this.isFields},n.prototype.startBatchInterpolate=function(t,i,e){},n}(),O={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:1/25,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0};function M(n,t,i,e){return Math.max(0,Math.min(e.length-1,Math.round((n-t)/(i-t)*(e.length-1))))}var k=function(){function n(t,i,e){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),e&&this.updateData(e)}return n.prototype.setOptions=function(t){this.options=Object.assign({},O,t);var i=this.ctx.canvas,e=i.width,r=i.height;"particleAge"in t&&!("maxAge"in t)&&b(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&b(this.options.particleMultiplier)&&(this.options.paths=Math.round(e*r*this.options.particleMultiplier)),this.prerender()},n.prototype.getOptions=function(){return this.options},n.prototype.updateData=function(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())},n.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,e=t.height,r=this.particles,s=this.options.maxAge,o=y(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,a=o,h=0,l=r.length;h<l;h++){var c=r[h];c.age>s&&(c.age=0,this.field.randomize(c,i,e,this.unproject));var f=c.x,v=c.y,m=this.field.interpolatedValueAt(f,v);if(m===null)c.age=s;else{var x=f+m.u*a,A=v+m.v*a;this.field.hasValueAt(x,A)?(c.xt=x,c.yt=A,c.m=m.m):(c.x=x,c.y=A,c.age=s)}c.age++}},n.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},n.prototype.drawParticles=function(){var t,i=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=b(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=W(this.options.colorScale)?this.options.colorScale:"#fff";var e=0,r=i.length;if(this.field&&r>0){var s=void 0,o=void 0;for(p(this.options.minVelocity)&&p(this.options.maxVelocity)?(s=this.options.minVelocity,o=this.options.maxVelocity):(t=this.field.range,s=t[0],o=t[1]);e<r;e++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](i[e],s,o)}},n.prototype.drawPixelParticle=function(t,i,e){var r=[t.x,t.y],s=[t.xt,t.yt];if(s&&r&&p(s[0])&&p(s[1])&&p(r[0])&&p(r[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]),this.ctx.lineTo(s[0],s[1]),y(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var o=M(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[o]}y(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},n.prototype.drawCoordsParticle=function(t,i,e){var r=[t.x,t.y],s=[t.xt,t.yt];if(s&&r&&p(s[0])&&p(s[1])&&p(r[0])&&p(r[1])&&this.intersectsCoordinate(s)&&t.age<=this.options.maxAge){var o=this.project(r),a=this.project(s);if(o&&a){if(this.ctx.beginPath(),this.ctx.moveTo(o[0],o[1]),this.ctx.lineTo(a[0],a[1]),t.x=t.xt,t.y=t.yt,y(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var h=M(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[h]}y(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},n.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,e=t.height,r=typeof this.options.paths=="function"?this.options.paths(this):this.options.paths,s=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,e,this.unproject);for(var o=0;o<r;o++)s.push(this.field.randomize({age:this.randomize()},i,e,this.unproject));return s},n.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},n.prototype.project=function(){throw new Error("project must be overriden")},n.prototype.unproject=function(){throw new Error("unproject must be overriden")},n.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},n.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},n.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},n.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},n.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},n.prototype.prerender=function(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,!this.starting&&!this.forceStop&&(this.starting=!0,this._then=Date.now(),this.animate()))},n.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},n.prototype.postrender=function(){},n.Field=C,n}();class P{constructor(t,i={}){this.canvas=null,this.wind=null,this.field=null,this.viewer=null,this.options=V({},i),this.pickWindOptions();const e=document.createElement("canvas");e.style.cssText="position:absolute; left:0; top:0;user-select:none;pointer-events: none;",e.className="cesium-wind-j",this.canvas=e,t&&this.setData(t)}addTo(t){this.viewer=t,this.appendCanvas(),this.render(this.canvas)}remove(){!this.viewer||(this.wind&&this.wind.stop(),this.canvas&&_(this.canvas),delete this.canvas)}removeLayer(){this.remove()}setData(t){return t&&t.checkFields&&t.checkFields()?this.field=t:D(t)?this.field=T(t):console.error("Illegal data"),this.viewer&&this.canvas&&this.field&&(this.wind.updateData(this.field),this.appendCanvas(),this.render(this.canvas)),this}getData(){return this.field}getWindOptions(){return this.options.windOptions||{}}pickWindOptions(){Object.keys(O).forEach(t=>{t in this.options&&(this.options.windOptions===void 0&&(this.options.windOptions={}),this.options.windOptions[t]=this.options[t])})}getContext(){if(this.canvas!==null)return this.canvas.getContext("2d")}appendCanvas(){if(!this.viewer||!this.canvas||document.querySelector(".cesium-wind-j"))return;this.adjustSize(),this.viewer.canvas.parentNode.appendChild(this.canvas)}adjustSize(){const t=this.viewer,i=this.canvas,{width:e,height:r}=t.canvas,s=1;i.width=e*s,i.height=r*s,i.style.width=e+"px",i.style.height=r+"px"}render(t){if(!this.getData()||!this.viewer)return this;const i=this.getWindOptions();if(t&&!this.wind){const e=this.getData(),r=this.getContext();r&&(this.wind=new k(r,i,e),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=()=>{})}return this.wind&&(this.wind.prerender(),this.wind.render()),this}project(t){const i=Cesium.Cartesian3.fromDegrees(t[0],t[1]),e=this.viewer.scene,r=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,i);return[r.x,r.y]}unproject(t){const i=this.viewer,e=new Cesium.Cartesian2(t[0],t[1]),r=i.scene.globe.pick(i.camera.getPickRay(e),i.scene);if(!r)return null;const o=i.scene.globe.ellipsoid.cartesianToCartographic(r),a=Cesium.Math.toDegrees(o.latitude);return[Cesium.Math.toDegrees(o.longitude),a]}intersectsCoordinate(t){const i=Cesium.Ellipsoid.WGS84,e=this.viewer.camera,r=new Cesium.EllipsoidalOccluder(i,e.position),s=Cesium.Cartesian3.fromDegrees(t[0],t[1]);return r.isPointVisible(s)}}const X=P;d.Field=C,d.WindLayer=X,d.default=P,Object.defineProperty(d,"__esModule",{value:!0})});const E={__name:"wind3D",setup(d){const g={colorScale:["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],frameRate:16,maxAge:60,globalAlpha:.9,velocityScale:.03333333333333333,paths:2e3};let w;return fetch("/json/2024122600.json").then(u=>u.json()).then(u=>{w=new window.CesiumWind.WindLayer(u,{windOptions:g}),w.addTo(window.__viewer)}),(u,j)=>(R(),L("div"))}};export{E as default};
